name: Code Statistics

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  statistics:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0  # Fetch full history for accurate stats
    
    - name: Install cloc (Count Lines of Code)
      run: sudo apt-get update && sudo apt-get install -y cloc
    
    - name: Count lines of code
      run: |
        echo "## 📊 Code Statistics" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Total Lines of Code" >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY
        cloc . --exclude-dir=node_modules,build,dist,.git --md >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY
        
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Detailed Breakdown" >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY
        cloc . --exclude-dir=node_modules,build,dist,.git --by-file >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY
    
    - name: File count statistics
      run: |
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### 📁 File Statistics" >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY
        echo "JavaScript/TypeScript files: $(find . -name "*.js" -o -name "*.jsx" -o -name "*.ts" -o -name "*.tsx" | grep -v node_modules | wc -l)"
        echo "CSS files: $(find . -name "*.css" -o -name "*.scss" -o -name "*.sass" | grep -v node_modules | wc -l)"
        echo "HTML files: $(find . -name "*.html" | grep -v node_modules | wc -l)"
        echo "JSON files: $(find . -name "*.json" | grep -v node_modules | wc -l)"
        echo "Markdown files: $(find . -name "*.md" | wc -l)"
        echo "Total project files: $(find . -type f | grep -v node_modules | grep -v .git | wc -l)"
        echo '```' >> $GITHUB_STEP_SUMMARY
    
    - name: Repository size
      run: |
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### 💾 Repository Size" >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY
        du -sh . --exclude=node_modules --exclude=.git
        echo '```' >> $GITHUB_STEP_SUMMARY
    
    - name: Git statistics
      run: |
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### 🔄 Git Statistics" >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY
        echo "Total commits: $(git rev-list --count HEAD)"
        echo "Contributors: $(git log --format='%aN' | sort -u | wc -l)"
        echo "Branches: $(git branch -r | wc -l)"
        echo '```' >> $GITHUB_STEP_SUMMARY
